import{d as e,r as a,I as l,bl as t,a1 as r,bm as i,g as s,h as d,o,c,w as u,b as n,D as p,A as v,E as m,f,e as _,P as y,R as x,Q as b,v as h,i as g,aa as k,j as C,bn as j,H as S,bo as w,S as V,u as A,B as P,n as q,bp as I,bq as z,a as $,F as E,K as M}from"./index-000ef0fb.js";import{_ as U}from"./u-input.0aaedf0a.js";import{_ as R,a as T}from"./u-form.e2126636.js";import{_ as O}from"./u-switch.fd45b0e5.js";import{_ as B}from"./u-button.cdb9d635.js";import{_ as D}from"./u-popup.bdec7df3.js";import{m as F}from"./manifest.78a5c925.js";import"./u-icon.f8309613.js";import"./_plugin-vue_export-helper.1b428a4d.js";import"./u-line.ede52530.js";import"./u-loading-icon.d02ed416.js";import"./u-transition.3ad24640.js";import"./u-safe-bottom.9eba99f8.js";const H=e({__name:"area-select",props:{areaId:{type:Number,default:0}},emits:["complete"],setup(e,{expose:C,emit:j}){const S=e,w=a(!1),V=l({province:[],city:[],district:[]}),A=a("province"),P=l({province:null,city:null,district:null});t(0).then((({data:e})=>{V.province=e})).catch(),r((()=>S.areaId),((e,a)=>{e&&!a&&i(e).then((({data:e})=>{e.province&&(P.province=e.province),e.city&&(P.city=e.city),e.district&&(P.district=e.district)})).catch()}),{immediate:!0}),r((()=>P.province),(()=>{t(P.province.id).then((({data:e})=>{if(V.city=e,A.value="city",P.city){let a=!1;for(let l=0;l<e.length;l++)if(P.city.id==e[l].id){a=!0;break}a||(P.city=null)}})).catch()}),{deep:!0}),r((()=>P.city),(e=>{e?t(P.city.id).then((({data:e})=>{if(V.district=e,A.value="district",P.district){let a=!1;for(let l=0;l<e.length;l++)if(P.district.id==e[l].id){a=!0;break}a||(P.district=null)}})).catch():(V.district=[],P.district=null)}),{deep:!0}),r((()=>P.district),(e=>{e&&(A.value="district",j("complete",P),w.value=!1)}),{deep:!0});return C({open:()=>{w.value=!0}}),(e,a)=>{const l=g,t=k,r=s(d("u-popup"),D);return o(),c(r,{show:w.value,onClose:a[3]||(a[3]=e=>w.value=!1),mode:"bottom",round:10,closeable:!0},{default:u((()=>[n(l,{class:"text-center p-[30rpx]"},{default:u((()=>[p("请选择地区")])),_:1}),n(l,{class:"flex p-[30rpx] text-sm font-semibold"},{default:u((()=>[V.province.length?(o(),c(l,{key:0,class:v(["flex-1",{"text-[var(--primary-color)]":"province"==A.value}]),onClick:a[0]||(a[0]=e=>A.value="province")},{default:u((()=>[P.province?(o(),c(l,{key:0},{default:u((()=>[p(m(P.province.name),1)])),_:1})):(o(),c(l,{key:1},{default:u((()=>[p("请选择")])),_:1}))])),_:1},8,["class"])):f("v-if",!0),V.city.length?(o(),c(l,{key:1,class:v(["flex-1",{"text-[var(--primary-color)]":"city"==A.value}]),onClick:a[1]||(a[1]=e=>A.value="city")},{default:u((()=>[P.city?(o(),c(l,{key:0},{default:u((()=>[p(m(P.city.name),1)])),_:1})):(o(),c(l,{key:1},{default:u((()=>[p("请选择")])),_:1}))])),_:1},8,["class"])):f("v-if",!0),V.district.length?(o(),c(l,{key:2,class:v(["flex-1",{"text-[var(--primary-color)]":"district"==A.value}]),onClick:a[2]||(a[2]=e=>A.value="district")},{default:u((()=>[P.district?(o(),c(l,{key:0},{default:u((()=>[p(m(P.district.name),1)])),_:1})):(o(),c(l,{key:1},{default:u((()=>[p("请选择")])),_:1}))])),_:1},8,["class"])):f("v-if",!0)])),_:1}),n(t,{"scroll-y":"true",class:"h-[50vh]"},{default:u((()=>[n(l,{class:"flex p-[30rpx] pt-0 text-sm"},{default:u((()=>[V.province.length?_((o(),c(l,{key:0},{default:u((()=>[(o(!0),y(x,null,b(V.province,(e=>(o(),c(l,{class:v(["leading-loose",{"text-[var(--primary-color)]":P.province&&P.province.id==e.id}]),onClick:a=>P.province=e},{default:u((()=>[p(m(e.name),1)])),_:2},1032,["class","onClick"])))),256))])),_:1},512)),[[h,"province"==A.value]]):f("v-if",!0),V.city.length?_((o(),c(l,{key:1},{default:u((()=>[(o(!0),y(x,null,b(V.city,(e=>(o(),c(l,{class:v(["leading-loose",{"text-[var(--primary-color)]":P.city&&P.city.id==e.id}]),onClick:a=>P.city=e},{default:u((()=>[p(m(e.name),1)])),_:2},1032,["class","onClick"])))),256))])),_:1},512)),[[h,"city"==A.value]]):f("v-if",!0),V.district.length?_((o(),c(l,{key:2},{default:u((()=>[(o(!0),y(x,null,b(V.district,(e=>(o(),c(l,{class:v(["leading-loose",{"text-[var(--primary-color)]":P.district&&P.district.id==e.id}]),onClick:a=>P.district=e},{default:u((()=>[p(m(e.name),1)])),_:2},1032,["class","onClick"])))),256))])),_:1},512)),[[h,"district"==A.value]]):f("v-if",!0)])),_:1})])),_:1})])),_:1},8,["show"])}}}),K=e({__name:"address_edit",setup(e){const l=a({id:0,name:"",mobile:"",province_id:0,city_id:0,district_id:0,lat:"",lng:"",address:"",address_name:"",full_address:"",is_default:0,area:""}),t=a(),r=a(null),i=a(""),v=a(!1);let _=a(!1),y=a("address"),x=a(2);C((e=>{x.value=e.isSelectMap||"";const a=uni.getStorageSync("selectAddressCallback");if(e.id)j(e.id).then((e=>{e.data&&Object.assign(l.value,e.data),y.value=e.data.lat&&e.data.lng?"locationAddress":"address",a&&(y.value="express"==a.delivery?"address":"locationAddress")})).catch();else if(e.name){uni.getStorageSync("addressInfo")&&Object.assign(l.value,uni.getStorageSync("addressInfo")),l.value.address=e.name,Q(e.latng);var t=W("latng").split(",");l.value.lat=t[0],l.value.lng=t[1]}i.value=e.source||"",a&&(y.value="express"==a.delivery?"address":"locationAddress")}));const b=S((()=>({name:{type:"string",required:!0,message:M("namePlaceholder"),trigger:["blur","change"]},mobile:[{type:"string",required:!0,message:M("mobilePlaceholder"),trigger:["blur","change"]},{validator(e,a,l){/^1[3-9]\d{9}$/.test(a)?l():l(new Error(M("mobileError")))}}],area:{validator(){let e=!0;return uni.$u.test.isEmpty(l.value.area)&&uni.$u.test.isEmpty(l.value.address_name)&&(e=!1),e},message:M("selectAreaPlaceholder")},address:{type:"string",required:!0,message:M("addressPlaceholder"),trigger:["blur","change"]}}))),h=()=>{_.value=!0,t.value.open()},k=e=>{!_.value||l.value.province_id!=e.province.id&&l.value.city_id==e.city.id&&l.value.district_id==e.district.id||(l.value.lat="",l.value.lng=""),l.value.province_id=e.province.id||0,l.value.city_id=e.city.id||0,l.value.district_id=e.district.id||0,l.value.area=`${e.province.name||""}${e.city.name||""}${e.district.name||""}`,_.value=!1},D=a(!1),K=()=>{const e=l.value.id?I:z;r.value.validate().then((()=>{if(!D.value){if(D.value=!0,v.value=!0,l.value.full_address=l.value.area+l.value.address,1==x.value&&!l.value.lat&&!l.value.lng)return V({title:"缺少经纬度，请在地图上重新选点",icon:"none"}),D.value=!1,v.value=!1,!1;e(l.value).then((e=>{D.value=!1,setTimeout((()=>{if(v.value=!1,"shop_order_payment"==i.value){const a=uni.getStorageSync("selectAddressCallback");a&&(a.address_id=e.data.id||l.value.id,uni.setStorage({key:"selectAddressCallback",data:a,success(){$({url:a.back,mode:"redirectTo"})}}))}else $({url:"/app/pages/member/address",mode:"redirectTo",param:{source:i.value}})}),1e3)})).catch((()=>{D.value=!1,v.value=!1}))}}))},N=(e={})=>{var a=l.value;uni.setStorageSync("addressInfo",a);let t=location.origin+location.pathname+"?source="+i.value;x.value&&(t=t+"&isSelectMap="+x.value),window.location.href="https://apis.map.qq.com/tools/locpicker?search=1&type=0&backurl="+encodeURIComponent(t)+"&key="+F.h5.sdkConfigs.maps.qqmap.key+"&referer=myapp"},Q=e=>{w({latlng:e}).then((e=>{e.data?(l.value.full_address="",l.value.full_address+=null!=e.data.province?e.data.province:"",l.value.full_address+=null!=e.data.city?""+e.data.city:"",l.value.full_address+=null!=e.data.district?""+e.data.district:"",l.value.address_name=l.value.full_address.replace(/-/g,""),l.value.area=e.data.full_address,l.value.province_id=null!=e.data.province_id?e.data.province_id:0,l.value.city_id=null!=e.data.city_id?e.data.city_id:0,l.value.district_id=null!=e.data.district_id?e.data.district_id:0):V({title:e.msg,icon:"none"})}))},W=e=>{for(var a=window.location.search.substring(1).split("&"),l=0;l<a.length;l++){var t=a[l].split("=");if(t[0]==e)return t[1]}return!1};return(e,a)=>{const i=s(d("u-input"),U),_=s(d("u-form-item"),R),C=g,j=E,S=s(d("u-switch"),O),w=s(d("u-button"),B),V=s(d("u-form"),T),I=s(d("area-select"),H);return o(),c(C,{class:"px-[30rpx]",style:q(e.themeColor())},{default:u((()=>[n(V,{labelPosition:"left",model:l.value,labelWidth:"200rpx",errorType:"toast",rules:A(b),ref_key:"formRef",ref:r},{default:u((()=>[n(C,{class:"mt-[10rpx]"},{default:u((()=>[n(_,{label:A(M)("name"),prop:"name","border-bottom":!0},{default:u((()=>[n(i,{fontSize:"30rpx",modelValue:l.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value.name=e),modelModifiers:{trim:!0},border:"none",clearable:"",maxlength:"25",placeholder:A(M)("namePlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),n(C,{class:"mt-[10rpx]"},{default:u((()=>[n(_,{label:A(M)("mobile"),prop:"mobile","border-bottom":!0},{default:u((()=>[n(i,{fontSize:"30rpx",modelValue:l.value.mobile,"onUpdate:modelValue":a[1]||(a[1]=e=>l.value.mobile=e),modelModifiers:{trim:!0},border:"none",clearable:"",placeholder:A(M)("mobilePlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),n(C,{class:"mt-[10rpx]"},{default:u((()=>[n(_,{label:A(M)("selectArea"),prop:"area","border-bottom":!0},{default:u((()=>["address"==A(y)&&1!=A(x)?(o(),c(C,{key:0,class:"flex w-full items-center",onClick:h},{default:u((()=>[l.value.area?(o(),c(C,{key:1,class:"text-[30rpx] flex-1"},{default:u((()=>[p(m(l.value.area),1)])),_:1})):(o(),c(C,{key:0,class:"text-gray-placeholder text-[30rpx] flex-1"},{default:u((()=>[p(m(A(M)("selectAreaPlaceholder")),1)])),_:1})),n(C,{onClick:P(N,["stop"]),class:"flex items-center"},{default:u((()=>[n(j,{class:"nc-iconfont nc-icon-dizhiguanliV6xx mr-[4rpx] text-[32rpx] text-[#e93323]"}),n(j,{class:"text-[24rpx] whitespace-nowrap"},{default:u((()=>[p("定位")])),_:1})])),_:1},8,["onClick"])])),_:1})):(o(),c(C,{key:1,class:"flex justify-between items-center flex-1",onClick:N},{default:u((()=>[l.value.area||l.value.address_name?(o(),c(C,{key:0,class:"text-[30rpx] text-[#303133]"},{default:u((()=>[p(m(l.value.area||l.value.address_name),1)])),_:1})):(o(),c(C,{key:1,class:"text-[#c3c4d5] text-[30rpx]"},{default:u((()=>[p(m(A(M)("selectAddressPlaceholder")),1)])),_:1})),n(C,{class:"flex items-center"},{default:u((()=>[n(j,{class:"nc-iconfont nc-icon-dizhiguanliV6xx text-[32rpx] mr-[4rpx] text-[#e93323]"}),n(j,{class:"text-[24rpx] whitespace-nowrap"},{default:u((()=>[p("定位")])),_:1})])),_:1})])),_:1}))])),_:1},8,["label"])])),_:1}),n(C,{class:"mt-[10rpx]"},{default:u((()=>[n(_,{label:A(M)("address"),prop:"address","border-bottom":!0},{default:u((()=>[n(i,{fontSize:"30rpx",modelValue:l.value.address,"onUpdate:modelValue":a[2]||(a[2]=e=>l.value.address=e),modelModifiers:{trim:!0},border:"none",clearable:"",maxlength:"120",placeholder:A(M)("addressPlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),n(C,{class:"mt-[10rpx]"},{default:u((()=>[n(_,{label:A(M)("defaultAddress"),prop:"name","border-bottom":!0},{default:u((()=>[n(S,{modelValue:l.value.is_default,"onUpdate:modelValue":a[3]||(a[3]=e=>l.value.is_default=e),size:"20",activeValue:1,inactiveValue:0,activeColor:"var(--primary-color)"},null,8,["modelValue"])])),_:1},8,["label"])])),_:1}),n(C,{class:"mt-[40rpx]"},{default:u((()=>[n(w,{type:"primary",shape:"circle",text:A(M)("save"),onClick:K,disabled:v.value,loading:D.value},null,8,["text","disabled","loading"])])),_:1})])),_:1},8,["model","rules"]),"address"==A(y)?(o(),c(I,{key:0,ref_key:"areaRef",ref:t,onComplete:k,"area-id":l.value.district_id},null,8,["area-id"])):f("v-if",!0)])),_:1},8,["style"])}}});export{K as default};
