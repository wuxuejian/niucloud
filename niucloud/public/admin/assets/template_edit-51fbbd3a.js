import{d as ee,x as te,f as ae,r as T,n as le,l as oe,q as c,h as s,c as v,e as u,w as d,u as g,R as se,s as x,a as _,t as h,F as U,T as B,i as j,B as V,$ as ne,aX as re,U as S,aP as ue,a6 as de,K as pe,L as ie,as as me,at as ce,au as ve,bT as _e,aa as fe,aB as ye,M as be,E as ke,Y as ge}from"./index-39857e33.js";/* empty css                   *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                          *//* empty css                    *//* empty css                       *//* empty css                 *//* empty css                *//* empty css                       */import{b as xe,i as he,j as Ve,k as we}from"./printer-5e7bf923.js";const Ee={class:"main-container"},Te={class:"flex"},Ue={class:"flex-1 mr-[20px] bg-[#fff]"},Pe={class:"panel-title !text-sm"},Ce={class:"panel-title !text-sm"},Ne={class:"panel-title !text-sm"},Be={class:"flex"},Fe={class:"leading-[30px] w-[50px] text-center text-[#707070] bg-[#d7d7d7] border-1 border-solid border-[#ededed]"},je={key:4,class:"flex mr-[30px]"},Oe=_("div",{class:"leading-[30px] w-[50px] text-center text-[#707070] bg-[#d7d7d7] border-1 border-solid border-[#ededed]"},"字号",-1),Re={key:5,class:"flex mr-[30px]"},Se=_("div",{class:"leading-[30px] w-[50px] text-center text-[#707070] bg-[#d7d7d7] border-1 border-solid border-[#ededed]"},"粗细",-1),ze={key:0,class:"text-[12px] text-[#b2b2b2] mt-[10px]"},De={class:"panel-title !text-sm"},Le={class:"fixed-footer-wrap"},Me={class:"fixed-footer"},nt=ee({__name:"template_edit",setup($e){const z=te(),A=ae(),H=z.meta.title,P=T(!1),C=T(!0),K={template_id:z.query.template_id||0,template_type:"",template_name:"",value:{}},e=le({...K}),D=T(),X=oe(()=>({template_name:[{required:!0,message:c("templateNamePlaceholder"),trigger:"blur"}],template_type:[{required:!0,message:c("templateTypePlaceholder"),trigger:"blur"}]})),L=Object.assign({}),M=Object.assign({});M&&Object.assign(L,M);const $={};for(const[r,o]of Object.entries(L)){const n=r.split("/").pop().split(".")[0];$[n]=o.default}const W=T(""),f=T([]),w=T([]);(async()=>{await xe({}).then(r=>{r.data&&r.data.length&&(f.value=r.data,q(f.value[0].key,Boolean(parseInt(e.template_id)))),e.template_id||(C.value=!1)}),e.template_id&&he(e.template_id).then(r=>{let o=r.data;o&&Object.keys(o).length?(Object.keys(e).forEach(l=>{if(l=="value")for(let n in e[l])Object.assign(e[l][n],o[l][n]);else e[l]=o[l]}),C.value=!1):(S({type:"warning",duration:1500,message:c("printTemplateEmpty")}),setTimeout(()=>{F(),C.value=!1},2e3))})})();const q=(r,o=!1)=>{for(let l=0;l<f.value.length;l++)if(f.value[l].key==r){e.template_type=f.value[l].key,W.value=f.value[l].path,w.value=f.value[l].template;break}for(let l in e.value)delete e.value[l];Y()},Y=()=>{for(let r=0;r<w.value.length;r++){let o=w.value[r];e.value[o.key]={};for(let l=0;l<o.list.length;l++){let n=o.list[l];e.value[o.key][n.key]={type:n.type,value:n.value,status:n.status,fontSize:n.fontSize,fontWeight:n.fontWeight}}}},J=async r=>{if(C.value||!r)return;if(f.value.length==0){S({type:"warning",message:c("printTypeEmpty")});return}let o=e.template_id?Ve:we;await r.validate(async l=>{if(l){let n=!1,E="";for(let y=0;y<w.value.length;y++){let m=w.value[y],b=!1;for(let k=0;k<m.list.length;k++){let i=m.list[k];if(e.value[m.key][i.key].status!=0){if(i.type=="input"){if(e.value[m.key][i.key].value==""){n=!0,E=`请输入${i.label}`,b=!0;break}}else if(i.type=="select"&&e.value[m.key][i.key].value==""){n=!0,E=`${i.label}未设置[${i.text}]`,b=!0;break}}}if(b)break}if(n){S({type:"warning",message:E});return}for(let y=0;y<w.value.length;y++){let m=w.value[y];for(let b=0;b<m.list.length;b++){let k=m.list[b];k.type=="checkbox"&&(e.value[m.key][k.key].value.length?e.value[m.key][k.key].status=1:e.value[m.key][k.key].status=0)}}if(P.value)return;P.value=!0,o(e).then(y=>{P.value=!1,e.template_id||F()}).catch(y=>{P.value=!1})}})},F=()=>{A.push("/printer/template/list")};return(r,o)=>{const l=ue,n=de,E=pe,O=ie,y=me,m=ce,b=ve,k=_e,i=fe,R=ye,Q=be,G=ke,Z=ge;return s(),v("div",Ee,[u(n,{class:"card !border-none mb-[15px]",shadow:"never"},{default:d(()=>[u(l,{content:g(H),icon:r.ArrowLeft,onBack:F},null,8,["content","icon"])]),_:1}),se((s(),x(Q,{class:"page-form",model:e,rules:g(X),"label-width":"150px",ref_key:"formRef",ref:D},{default:d(()=>[_("div",Te,[_("div",Ue,[u(n,{class:"box-card !border-none",shadow:"never"},{default:d(()=>[_("h3",Pe,h(g(c)("templateInfoLabel")),1),u(O,{label:g(c)("templateName"),prop:"template_name"},{default:d(()=>[u(E,{modelValue:e.template_name,"onUpdate:modelValue":o[0]||(o[0]=a=>e.template_name=a),modelModifiers:{trim:!0},clearable:"",placeholder:g(c)("templateNamePlaceholder"),class:"input-width",maxlength:"20"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),f.value.length?(s(),x(O,{key:0,label:g(c)("templateType"),prop:"template_type"},{default:d(()=>[u(m,{modelValue:e.template_type,"onUpdate:modelValue":o[1]||(o[1]=a=>e.template_type=a)},{default:d(()=>[(s(!0),v(U,null,B(f.value,a=>(s(),x(y,{key:a.key,label:a.key,onChange:q},{default:d(()=>[j(h(a.title),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):V("",!0)]),_:1}),f.value.length?(s(),x(n,{key:0,class:"box-card !border-none",shadow:"never"},{default:d(()=>[_("h3",Ce,h(g(c)("templateEditLabel")),1),(s(!0),v(U,null,B(w.value,a=>(s(),v("div",{key:a.key,class:"bg-[#f8f8f9] mb-[20px] py-[20px] px-[40px] text-[14px]"},[_("h4",Ne,h(a.title),1),(s(!0),v(U,null,B(a.list,(t,I)=>(s(),v("div",{key:t.key,class:"ml-[30px]",style:ne({"margin-bottom":a.list.length==I+1?"0":"20px"})},[_("div",Be,[t.label?(s(),x(b,{key:0,modelValue:e.value[a.key][t.key].status,"onUpdate:modelValue":p=>e.value[a.key][t.key].status=p,label:t.label,value:t.status,"true-value":1,"false-value":0,class:"w-[180px] mr-[10px]",disabled:t.disabled},null,8,["modelValue","onUpdate:modelValue","label","value","disabled"])):V("",!0),t.type=="input"?(s(),x(E,{key:1,modelValue:e.value[a.key][t.key].value,"onUpdate:modelValue":p=>e.value[a.key][t.key].value=p,modelModifiers:{trim:!0},clearable:"",placeholder:"请输入"+(t.placeholder?t.placeholder:t.label),class:"input-width mr-[30px]",maxlength:"32"},null,8,["modelValue","onUpdate:modelValue","placeholder"])):V("",!0),t.type=="checkbox"?(s(),x(k,{key:2,modelValue:e.value[a.key][t.key].value,"onUpdate:modelValue":p=>e.value[a.key][t.key].value=p,class:"mr-[30px]"},{default:d(()=>[(s(!0),v(U,null,B(t.list,(p,N)=>(s(),x(b,{label:N,key:N,disabled:t.disabled},{default:d(()=>[j(h(p),1)]),_:2},1032,["label","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):V("",!0),t.type=="select"?(s(),v(U,{key:3},[_("div",Fe,h(t.text),1),u(R,{modelValue:e.value[a.key][t.key].value,"onUpdate:modelValue":p=>e.value[a.key][t.key].value=p,class:"!w-[130px] mr-[30px]"},{default:d(()=>[(s(!0),v(U,null,B(t.list,(p,N)=>(s(),x(i,{key:N,label:p,value:N},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])],64)):V("",!0),t.fontSize?(s(),v("div",je,[Oe,u(R,{modelValue:e.value[a.key][t.key].fontSize,"onUpdate:modelValue":p=>e.value[a.key][t.key].fontSize=p,class:"!w-[130px]"},{default:d(()=>[u(i,{label:"小",value:"normal"}),u(i,{label:"大",value:"big"})]),_:2},1032,["modelValue","onUpdate:modelValue"])])):V("",!0),t.fontWeight?(s(),v("div",Re,[Se,u(R,{modelValue:e.value[a.key][t.key].fontWeight,"onUpdate:modelValue":p=>e.value[a.key][t.key].fontWeight=p,class:"!w-[130px]"},{default:d(()=>[u(i,{label:"正常",value:"normal"}),u(i,{label:"加粗",value:"bold"})]),_:2},1032,["modelValue","onUpdate:modelValue"])])):V("",!0)]),t.remark?(s(),v("div",ze,h(t.remark),1)):V("",!0)],4))),128))]))),128))]),_:1})):V("",!0)]),u(n,{class:"box-card !border-none w-[450px]",shadow:"never"},{default:d(()=>[_("h3",De,h(g(c)("preview")),1),(s(),x(re($[W.value]),{value:e.value},null,8,["value"]))]),_:1})])]),_:1},8,["model","rules"])),[[Z,C.value]]),_("div",Le,[_("div",Me,[u(G,{type:"primary",loading:P.value,onClick:o[2]||(o[2]=a=>J(D.value))},{default:d(()=>[j(h(g(c)("save")),1)]),_:1},8,["loading"]),u(G,{onClick:o[3]||(o[3]=a=>F())},{default:d(()=>[j(h(g(c)("cancel")),1)]),_:1})])])])}}});export{nt as default};
