import{d as W,r as n,O as j,bI as F,b1 as J,n as z,b0 as A,s as Y,a2 as I,N as t,h as y,c as O,a as s,y as g,z as b,t as i,u as o,e as l,w as p,i as B,I as T,R as Z,B as G,W as H,Z as K,E as Q,_ as X,Y as ee,$ as ae}from"./index-d1ed2ead.js";/* empty css                     *//* empty css                 *//* empty css                        *//* empty css                  *//* empty css                 */import{g as te}from"./weapp-b1c1258a.js";import{b as se}from"./browser-a1ac24ac.js";const oe={class:"main-container w-[375px] mx-auto mt-[20px] mb-[40px] relative"},le={class:"flex full-container"},ne=["src"],pe={class:"w-[375px] border border-slate-100 bg-body pt-[20px] px-[20px]"},re={class:"font-bold text-xl mb-[40px]"},ie={class:"mb-[20px] flex flex-col"},ce={class:"mb-[10px]"},de={key:0,class:"w-[400px] absolute bg-body top-[10%] -right-[450px]"},ue={class:"info-wrap mt-[20px]"},me={class:"px-[20px] pb-[10px] font-bold"},_e={class:"px-[20px] pb-[10px] font-bold mt-[40px]"},ve={class:"text-gray-400"},ke=W({__name:"preview",setup(fe){const u=n(""),m=n(""),_=n(""),r=n(""),d=n(!1),v=n(!1),C=n(0),D=n(0),f=j();f.query.page=f.query.page||"",F("setLayout")("decorate"),J().then(e=>{u.value=e.data.wap_url,k()});const R=()=>{if(m.value.trim().length==0){I({type:"warning",message:`${t("wapDomainPlaceholder")}`});return}u.value=m.value+"/wap",k(),H.set({key:"wap_domain",data:u.value}),d.value=!0,v.value=!1},k=()=>{if(f.query.page){r.value=`${u.value}${f.query.page}`,se.toDataURL(r.value,{errorCorrectionLevel:"L",margin:0,width:100}).then(w=>{_.value=w});const e=()=>{C.value=new Date().getTime(),$()};e();let a=0,c=setInterval(()=>{if(E.value||a>=50){clearInterval(c);return}e(),a++},200);setTimeout(()=>{D.value==0&&L()},1e3*10)}},E=n(!1);window.addEventListener("message",e=>{try{let a={type:""};if(typeof e.data=="string"?a=JSON.parse(e.data):typeof e.data=="object"&&(a=e.data),a.type&&["appOnLaunch","appOnReady"].indexOf(a.type)!=-1){v.value=!1,d.value=!0;let c=new Date().getTime();E.value=!0,D.value=c-C.value}}catch(a){L(),console.log("preview 后台接受数据错误",a)}},!1);const $=()=>{const e=JSON.stringify({type:"appOnReady",message:"加载完成"});window.previewIframe&&window.previewIframe.contentWindow.postMessage(e,"*")},L=()=>{v.value=!0,d.value=!1,r.value="",_.value=""},h=z({qr_code:""});te().then(e=>{if(e.code==1){const a=e.data;h.qr_code=a.qr_code}});const{copy:U,isSupported:M,copied:q}=A(),P=e=>{M.value||I({message:t("notSupportCopy"),type:"warning"}),U(e)};return Y(q,()=>{q.value&&I({message:t("copySuccess"),type:"success"})}),(e,a)=>{const c=K,w=Q,x=X,S=ee,N=ae;return y(),O("div",oe,[s("div",le,[g(s("iframe",{class:"w-[375px]",src:r.value,frameborder:"0",id:"previewIframe"},null,8,ne),[[b,d.value]]),g(s("div",pe,[s("div",re,i(o(t)("developTitle")),1),s("div",ie,[s("text",ce,i(o(t)("wapDomain")),1),l(c,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=V=>m.value=V),placeholder:o(t)("wapDomainPlaceholder"),clearable:""},null,8,["modelValue","placeholder"])]),l(w,{type:"primary",onClick:R},{default:p(()=>[B(i(o(t)("confirm")),1)]),_:1})],512),[[b,v.value]]),d.value?(y(),O("div",de,[s("div",ue,[s("div",me,i(o(t)("h5")),1),l(N,{"label-width":"40px",class:"px-[20px]"},{default:p(()=>[g(l(x,{label:o(t)("link")},{default:p(()=>[l(c,{readonly:"",value:r.value},{append:p(()=>[l(w,{onClick:a[1]||(a[1]=V=>P(r.value)),class:"bg-primary copy"},{default:p(()=>[B(i(o(t)("copy")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),[[b,r.value]]),g(l(x,{label:" "},{default:p(()=>[l(S,{src:_.value},null,8,["src"])]),_:1},512),[[b,_.value]])]),_:1}),s("div",_e,i(o(t)("weapp")),1),l(N,{"label-width":"40px",class:"px-[20px]"},{default:p(()=>[h.qr_code?(y(),T(x,{key:0,label:" "},{default:p(()=>[l(S,{class:"w-[100px] h-[100px]",src:o(Z)(h.qr_code)},null,8,["src"])]),_:1})):(y(),T(x,{key:1,label:" "},{default:p(()=>[s("span",ve,i(o(t)("weappNotSet")),1)]),_:1}))]),_:1})])])):G("",!0)])])}}});export{ke as default};
