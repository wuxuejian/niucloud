import{N as B,d as G,r as g,a5 as J,Y as V,h as u,s as T,w as l,P as S,c as d,e,a as n,t as _,u as r,q as a,F as L,Q as D,B as M,a6 as F,a8 as K,a9 as R,_ as O,ag as W,ah as Z,X as ee,S as le,ai as te,a1 as ae,U as se}from"./index-ae2d9b78.js";/* empty css                   *//* empty css                  *//* empty css                   */import{T as oe,_ as ne}from"./vue-web-terminal-6de9e244.js";/* empty css                     *//* empty css                *//* empty css               */import{_ as ue}from"./_plugin-vue_export-helper-c27b6911.js";function ce(){return B.post("niucloud/build",{})}function ie(){return B.get("niucloud/build")}function de(){return B.get("niucloud/build/log")}function re(){return B.post("niucloud/build/clear")}function pe(){return B.get("niucloud/build/check")}const _e={class:"h-[60vh]"},fe={key:0,class:"h-[60vh] flex flex-col"},ve={key:0,class:"bg-[#fff] my-3"},he={class:"pt-[20px] pl-[20px]"},me={class:"px-[20px] pt-[10px] text-[14px] el-table"},ge={key:0},xe={key:1},be={key:0},ke={key:1},Be={class:"h-[60vh]"},Ce={class:"h-[60vh] flex flex-col"},we={class:"flex-1 h-0"},ye=G({__name:"index",emits:["complete"],setup(Ee,{expose:U,emit:Te}){const c=g(!1),p=g(null),f=g("build"),x=g(null),b=g(!1),h=g(null);let k=[];(()=>{ie().then(({data:t})=>{t&&(p.value=t,c.value||q())}).catch()})();const C=()=>{de().then(t=>{if(!t.data){c.value&&k.length&&(f.value="complete",h.value.execute("clear")),w&&w.close(),p.value=null;return}const s=t.data.data??[];let o="";s[0]&&s[0].length&&c.value&&(k.length==0&&(h.value.execute("clear"),h.value.execute("开始编译")),s[0].forEach(i=>{k.includes(i.action)||(h.value.pushMessage({content:`正在执行：${i.action}`}),k.push(i.action),i.code==0&&(o=i.msg,h.value.pushMessage({content:i.msg,class:"error"})))})),!o&&setTimeout(()=>{C()},2e3)}).catch()};let w=null;const q=()=>{w=K.success({title:a("warning"),dangerouslyUseHTMLString:!0,message:R("div",{},[a("cloudbuild.executingTips"),R("span",{class:"text-primary cursor-pointer",onClick:P},[a("cloudbuild.clickView")])]),duration:0,showClose:!1})},P=()=>{c.value=!0,f.value="build",C()},$=async()=>{if(c.value=!0,b.value=!0,f.value="build",p.value){b.value=!1,C();return}pe().then(async({data:t})=>{t.is_pass?ce().then(({data:s})=>{b.value=!1,p.value=s,C()}).catch(()=>{c.value=!1}):(b.value=!1,x.value=t)}).catch(()=>{c.value=!1})};let y=null;const I=new oe,H=(t,s,o,i,E)=>{if(s=="开始编译"){o(I);const m=Q(["/","——","\\","|"]);y=setInterval(()=>{I.flush("> "+m.next().value)},150)}},Q=t=>{var s=0;return{next(){return s+1==t.length&&(s=0),{value:t[s++]}}}},X=t=>{f.value=="cloudbuild"&&p.value?O.confirm(a("cloudbuild.showDialogCloseTips"),a("warning"),{confirmButtonText:a("confirm"),cancelButtonText:a("cancel"),type:"warning"}).then(()=>{t()}).catch(()=>{}):t()};return J(()=>c.value,()=>{c.value||(f.value="build",k=[],y&&clearInterval(y),re())}),U({open:$,cloudBuildTask:p}),(t,s)=>{const o=W,i=Z,E=V("Select"),m=ee,N=V("CloseBold"),Y=le,j=te,z=ae,A=se;return u(),T(z,{modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=v=>c.value=v),title:r(a)("cloudbuild.title"),width:"850px","close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":X},{default:l(()=>[S((u(),d("div",_e,[x.value&&!p.value?(u(),d("div",fe,[e(Y,null,{default:l(()=>[x.value.dir?(u(),d("div",ve,[n("p",he,_(r(a)("cloudbuild.dirPermission")),1),n("div",me,[e(i,{class:"py-[10px] items table-head-bg pl-[15px] mb-[10px]"},{default:l(()=>[e(o,{span:12},{default:l(()=>[n("span",null,_(r(a)("cloudbuild.path")),1)]),_:1}),e(o,{span:6},{default:l(()=>[n("span",null,_(r(a)("cloudbuild.demand")),1)]),_:1}),e(o,{span:6},{default:l(()=>[n("span",null,_(r(a)("status")),1)]),_:1})]),_:1}),(u(!0),d(L,null,D(x.value.dir.is_readable,v=>(u(),T(i,{class:"pb-[10px] items pl-[15px]"},{default:l(()=>[e(o,{span:12},{default:l(()=>[n("span",null,_(v.dir),1)]),_:2},1024),e(o,{span:6},{default:l(()=>[n("span",null,_(r(a)("cloudbuild.readable")),1)]),_:1}),e(o,{span:6},{default:l(()=>[v.status?(u(),d("span",ge,[e(m,{color:"green"},{default:l(()=>[e(E)]),_:1})])):(u(),d("span",xe,[e(m,{color:"red"},{default:l(()=>[e(N)]),_:1})]))]),_:2},1024)]),_:2},1024))),256)),(u(!0),d(L,null,D(x.value.dir.is_write,v=>(u(),T(i,{class:"pb-[10px] items pl-[15px]"},{default:l(()=>[e(o,{span:12},{default:l(()=>[n("span",null,_(v.dir),1)]),_:2},1024),e(o,{span:6},{default:l(()=>[n("span",null,_(r(a)("cloudbuild.write")),1)]),_:1}),e(o,{span:6},{default:l(()=>[v.status?(u(),d("span",be,[e(m,{color:"green"},{default:l(()=>[e(E)]),_:1})])):(u(),d("span",ke,[e(m,{color:"red"},{default:l(()=>[e(N)]),_:1})]))]),_:2},1024)]),_:2},1024))),256))])])):M("",!0)]),_:1})])):M("",!0),S(n("div",Be,[e(r(ne),{ref_key:"terminalRef",ref:h,context:"","init-log":null,"show-header":!1,"show-log-time":!0,onExecCmd:H},null,512)],512),[[F,p.value]])])),[[F,f.value=="build"],[A,b.value]]),S(n("div",null,[n("div",Ce,[n("div",we,[e(j,{icon:"success",title:r(a)("cloudbuild.cloudbuildSuccess")},null,8,["title"])])])],512),[[F,f.value=="complete"]])]),_:1},8,["modelValue","title"])}}});const qe=ue(ye,[["__scopeId","data-v-5a176c78"]]);export{qe as default};
