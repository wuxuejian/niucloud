import{d as ze,r as L,n as V,a5 as Q,l as ne,cJ as Oe,G as Se,R as oe,au as b,A as z,h as s,c as p,a as d,e as n,u as o,q as i,w as a,v as T,t as r,F as P,Q as N,s as _,i as k,B as g,bS as Ue,P as se,a6 as Fe,av as ie,cK as je,cL as Be,_ as ce,cM as Le,cN as Te,cO as Pe,J as De,cP as Ne,cQ as Re,cR as Me,S as Je,E as Ke,cS as Qe,ag as qe,ah as Ge,I as We,ab as Xe,a4 as He,aB as Ye,T as Ze,ak as et,aI as tt,K as lt,L as at,a1 as nt,cT as ot,U as st,cU as it,cV as ct,cW as dt,cX as rt}from"./index-ae2d9b78.js";/* empty css                   */import{_ as ut}from"./index.vue_vue_type_script_setup_true_lang-57aca5c9.js";/* empty css                        *//* empty css                  *//* empty css                   *//* empty css                */import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                      *//* empty css                    *//* empty css                 */import"./el-tooltip-4ed993c7.js";/* empty css                 *//* empty css               *//* empty css                    *//* empty css                  *//* empty css                         */import{_ as mt}from"./index.vue_vue_type_script_setup_true_lang-43b3de63.js";import{_ as pt}from"./index.vue_vue_type_script_setup_true_lang-657c47c5.js";import{_ as ft}from"./_plugin-vue_export-helper-c27b6911.js";/* empty css                   *//* empty css                */const _t={class:"group-wrap w-[180px] p-[15px] h-full border-r border-color flex flex-col"},vt={class:"group-list flex-1 my-[10px] h-0"},gt=["onClick"],ht={key:0,class:"leading-none operate py-[10px]"},yt={class:"text-center w-full"},xt={class:"attachment-list-wrap flex flex-col p-[15px] flex-1 overflow-hidden"},kt={class:"flex"},wt={key:1},bt={class:"flex-1 my-[15px] h-0"},Ct={key:0,class:"flex flex-wrap"},Vt=["onClick"],Et=["src"],$t={class:"absolute z-[1] flex items-center justify-center w-full h-full inset-0 bg-black bg-opacity-60"},It={class:"file-box-active absolute z-[1] bottom-0 right-0 w-full h-full"},At={class:"absolute bottom-[2px] right-[2px] text-white z-[2] leading-none"},zt={class:"flex items-center"},Ot={class:"truncate my-[10px] cursor-pointer text-base flex-1 text-center"},St={class:"text-center w-full"},Ut={class:"text-center w-full"},Ft={class:"text-center w-full"},jt={class:"text-center w-full"},Bt={key:1,class:"flex flex-wrap"},Lt={class:"attachment-wrap w-full rounded cursor-pointer overflow-hidden relative flex items-center justify-center h-[120px]"},Tt=["src"],Pt={class:"flex items-center"},Dt={class:"truncate my-[10px] cursor-pointer text-base flex-1 text-center"},Nt={key:2,class:"flex items-center justify-center"},Rt={class:"flex items-center"},Mt={class:"flex h-full justify-end items-center"},Jt={class:"dialog-footer"},Kt=ze({__name:"attachment",props:{limit:{type:Number,default:1},type:{type:String,default:"image"},scene:{type:String,default:"select"}},setup(u,{expose:de}){const m=u,R=L(""),O=L(!1),f=V({}),A=V([]),E=V({data:[]}),c=V({loading:!0,page:1,total:0,limit:m.scene=="select"?10:20,data:[]});m.scene=="select"?(c.limit=10,m.type=="icon"&&(c.limit=20)):(c.limit=20,m.type=="icon"&&(c.limit=30));const M=V({name:""}),C=V({real_name:"",cate_id:0}),J=ie(()=>{(m.type=="icon"?it:ct)({type:m.type,...M}).then(e=>{E.data=e.data}).catch(()=>{})});J();const $=ie((l=1)=>{const e=m.type=="icon"?dt:rt;c.loading=!0,c.page=l,e({page:c.page,limit:c.limit,att_type:m.type,...C}).then(h=>{if(c.data=h.data.data,c.total=h.data.total,c.loading=!1,m.scene=="attachment"&&G(),m.type!="icon")for(let x=0;x<c.data.length;x++)c.data[x].image_list=[],c.data[x].image_list.push(z(h.data.data[x].url))}).catch(()=>{c.loading=!1})});$(),Q(()=>C.cate_id,()=>{$()});const re=l=>{je({type:m.type,name:l}).then(e=>{R.value="",J(1)}).catch(()=>{})},ue=(l,e)=>{Be({id:E.data[e].id,name:l}).then(h=>{E.data[e].name=l}).catch(()=>{})},me=l=>{ce.confirm(i("upload.deleteCategoryTips"),i("warning"),{confirmButtonText:i("confirm"),cancelButtonText:i("cancel"),type:"warning"}).then(()=>{Le(E.data[l].id).then(()=>{E.data.splice(l,1)}).catch(()=>{})})},q=L(null),pe=ne(()=>{const l={};return l.token=Oe(),l["site-id"]=Se.get("siteId")||0,{action:`/adminapi//sys/${m.type}`,multiple:!0,data:{cate_id:C.cate_id},headers:l,onSuccess:(e,h,x)=>{var B;e.code>=1?($(),(B=q.value)==null||B.handleRemove(h)):(h.status="fail",oe({message:e.msg,type:"error"}))}}}),U=L(!1);Q(U,()=>{if(U.value){const l=Object.keys(b(f));c.data.forEach(e=>{l.includes(e.att_id)||(f[e.att_id]=b(e))})}else G()});const G=()=>{const l=Object.keys(b(f));l.length&&(l.forEach(e=>{delete f[e]}),U.value=!1)},fe=l=>{if(f[l.att_id])delete f[l.att_id],A.splice(A.indexOf(l.att_id),1);else if(m.scene=="select"){const e=Object.keys(b(f)),h=e.length;if(m.limit==1&&h==m.limit)delete f[e[0]],A.splice(A.indexOf(e[0]),1);else if(h>=m.limit){oe.info(i("upload.triggerUpperLimit"));return}f[l.att_id]=b(l),A.push(l.att_id)}else f[l.att_id]=b(l),A.push(l.att_id)},_e=l=>{let e=A.indexOf(l);return e==-1?0:e+1},W=(l=null)=>{const e=l===null?Object.keys(b(f)):[c.data[l].att_id];ce.confirm(i("upload.deleteAttachmentTips"),i("warning"),{confirmButtonText:i("confirm"),cancelButtonText:i("cancel"),type:"warning"}).then(()=>{Te({att_ids:e}).then(()=>{$()}).catch(()=>{})})},v=V({cateId:"",loading:!1,visible:!1}),X=(l=null)=>{const e=l===null?Object.keys(b(f)):[c.data[l].att_id];v.visible=!0,v.cateId=E.data[0].id,v.confirm=()=>{v.loading=!0,Pe({cate_id:v.cateId,att_ids:e}).then(()=>{v.visible=!1,v.loading=!1,$()}).catch(()=>{v.loading=!1})}},K=L(!0);Q(f,()=>{K.value=Object.keys(b(f)).length==0});const F=V({show:!1,index:0}),ve=l=>{F.show=!0,F.index=l},ge=ne(()=>b(c.data).map(l=>z(l.url))),j=V({visible:!1,src:""}),he=l=>{j.visible=!0,j.src=z(c.data[l].url)};return de({selectedFile:f}),(l,e)=>{const h=De,x=pt,B=mt,S=Ne,H=Re,Y=Me,Z=Je,I=Ke,ye=Qe,D=qe,ee=Ge,te=We,le=Xe,xe=He,ke=Ye,we=Ze,be=et,Ce=tt,Ve=lt,Ee=at,ae=nt,$e=ot,Ie=ut,Ae=st;return s(),p("div",{class:T(["flex border-t border-b main-wrap border-color w-full",u.scene=="select"?"h-[40vh]":"h-full"])},[d("div",_t,[n(h,{modelValue:M.name,"onUpdate:modelValue":e[0]||(e[0]=t=>M.name=t),class:"m-0",placeholder:o(i)("upload.attachmentCategoryPlaceholder"),clearable:"","prefix-icon":"Search",onInput:e[1]||(e[1]=t=>o(J)())},null,8,["modelValue","placeholder"]),d("div",vt,[n(Z,null,{default:a(()=>[d("div",{class:T(["group-item p-[10px] leading-none text-xs rounded cursor-pointer",{active:C.cate_id==0}]),onClick:e[2]||(e[2]=t=>C.cate_id=0)},r(o(i)("selectPlaceholder")),3),(s(!0),p(P,null,N(E.data,(t,y)=>(s(),p("div",{class:T(["group-item px-[10px] text-xs rounded cursor-pointer flex",{active:C.cate_id==t.id}]),key:y},[d("div",{class:"flex-1 leading-none truncate py-[10px]",onClick:w=>C.cate_id=t.id},r(t.name),9,gt),u.scene=="attachment"&&m.type!="icon"?(s(),p("div",ht,[u.scene=="attachment"?(s(),_(Y,{key:0,"hide-on-click":!1},{dropdown:a(()=>[n(H,null,{default:a(()=>[n(S,{class:"text-center"},{default:a(()=>[n(B,{placeholder:o(i)("upload.attachmentCategoryPlaceholder"),onConfirm:w=>ue(w,y),modelValue:t.name,"onUpdate:modelValue":w=>t.name=w},{default:a(()=>[d("span",null,r(o(i)("edit")),1)]),_:2},1032,["placeholder","onConfirm","modelValue","onUpdate:modelValue"])]),_:2},1024),n(S,{onClick:w=>me(y)},{default:a(()=>[d("div",yt,r(o(i)("delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[n(x,{name:"element-MoreFilled",class:"cursor-pointer ml-[10px]",size:"14px"}),k(" "+r(t.name)+" ",1)]),_:2},1024)):g("",!0)])):g("",!0)],2))),128))]),_:1})]),m.type!="icon"?(s(),_(B,{key:0,placeholder:o(i)("upload.attachmentCategoryPlaceholder"),onConfirm:re,modelValue:R.value,"onUpdate:modelValue":e[3]||(e[3]=t=>R.value=t)},{default:a(()=>[n(I,null,{default:a(()=>[k(r(o(i)("upload.addAttachmentCategory")),1)]),_:1})]),_:1},8,["placeholder","modelValue"])):g("",!0)]),d("div",xt,[n(ee,{gutter:15,class:"h-[32px]"},{default:a(()=>[n(D,{span:10},{default:a(()=>[d("div",kt,[m.type!="icon"?(s(),_(ye,Ue({key:0},o(pe),{ref_key:"uploadRef",ref:q}),{default:a(()=>[n(I,{type:"primary"},{default:a(()=>[k(r(o(i)("upload.upload"+u.type))+" "+r(l.isOpen),1)]),_:1})]),_:1},16)):g("",!0),u.scene=="attachment"&&m.type!="icon"?(s(),p("div",wt,[O.value===!1?(s(),_(I,{key:0,class:"ml-[10px]",type:"primary",onClick:e[4]||(e[4]=t=>O.value=!0)},{default:a(()=>[k(r(o(i)("edit")),1)]),_:1})):(s(),_(I,{key:1,class:"ml-[10px]",type:"primary",onClick:e[5]||(e[5]=t=>O.value=!1)},{default:a(()=>[k(r(o(i)("complete")),1)]),_:1}))])):g("",!0)])]),_:1}),n(D,{span:14,class:"text-right"},{default:a(()=>[n(h,{modelValue:C.real_name,"onUpdate:modelValue":e[6]||(e[6]=t=>C.real_name=t),class:"m-0 !w-[200px]",clearable:"",placeholder:o(i)("upload.placeholder"+u.type+"Name"),"prefix-icon":"Search",onInput:e[7]||(e[7]=t=>o($)())},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),se((s(),p("div",bt,[n(Z,null,{default:a(()=>[c.data.length&&(O.value===!0||u.scene!="attachment")?(s(),p("div",Ct,[(s(!0),p(P,null,N(c.data,(t,y)=>(s(),p("div",{class:T(["attachment-item mr-[10px]",u.scene=="select"?"w-[100px]":"w-[120px]"]),key:y},[d("div",{class:T(["attachment-wrap w-full rounded cursor-pointer overflow-hidden relative flex items-center justify-center",u.scene=="select"?"h-[100px]":"h-[120px]"]),onClick:w=>fe(t)},[u.type=="image"?(s(),_(te,{key:0,src:o(z)(t.url),fit:"contain"},null,8,["src"])):u.type=="video"?(s(),p("video",{key:1,src:o(z)(t.url)},null,8,Et)):u.type=="icon"?(s(),_(x,{key:2,name:t.url,size:"40px"},null,8,["name"])):g("",!0),se(d("div",$t,[n(x,{name:"element-Select",color:"#fff",size:"40px"}),d("div",It,[d("span",At,r(_e(t.att_id)),1)])],512),[[Fe,f[t.att_id]]])],10,Vt),d("div",zt,[n(le,{placement:"top"},{content:a(()=>[k(r(t.real_name),1)]),default:a(()=>[d("div",Ot,r(t.real_name),1)]),_:2},1024),u.scene=="attachment"?(s(),_(Y,{key:0,"hide-on-click":!1,class:"attachment-action hidden"},{dropdown:a(()=>[n(H,null,{default:a(()=>[t.att_type=="image"?(s(),_(S,{key:0,class:"text-center",onClick:w=>ve(y)},{default:a(()=>[d("div",St,r(o(i)("lookOver")),1)]),_:2},1032,["onClick"])):g("",!0),t.att_type=="video"?(s(),_(S,{key:1,class:"text-center",onClick:w=>he(y)},{default:a(()=>[d("div",Ut,r(o(i)("lookOver")),1)]),_:2},1032,["onClick"])):g("",!0),n(S,{class:"text-center",onClick:w=>X(y)},{default:a(()=>[d("div",Ft,r(o(i)("upload.move")),1)]),_:2},1032,["onClick"]),n(S,{onClick:w=>W(y)},{default:a(()=>[d("div",jt,r(o(i)("delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[n(x,{name:"element-MoreFilled",class:"cursor-pointer ml-[8px]",size:"14px"})]),_:2},1024)):g("",!0)])],2))),128))])):c.data.length&&O.value===!1?(s(),p("div",Bt,[(s(!0),p(P,null,N(c.data,(t,y)=>(s(),p("div",{class:"attachment-item mr-[10px] w-[120px]",key:y},[d("div",Lt,[u.type=="image"?(s(),_(te,{key:0,src:o(z)(t.url),fit:"contain","preview-src-list":t.image_list},null,8,["src","preview-src-list"])):u.type=="video"?(s(),p("video",{key:1,src:o(z)(t.url)},null,8,Tt)):u.type=="icon"?(s(),_(x,{key:2,name:t.url,size:"40px"},null,8,["name"])):g("",!0)]),d("div",Pt,[n(le,{placement:"top"},{content:a(()=>[k(r(t.real_name),1)]),default:a(()=>[d("div",Dt,r(t.real_name),1)]),_:2},1024)])]))),128))])):(s(),p("div",Nt,[c.loading?g("",!0):(s(),_(xe,{key:0,description:u.type=="icon"?o(i)("upload.iconEmpty"):o(i)("upload.attachmentEmpty"),"image-size":100},null,8,["description"]))]))]),_:1})])),[[Ae,c.loading]]),n(ee,{gutter:20},{default:a(()=>[u.scene=="attachment"&&O.value===!0?(s(),_(D,{key:0,span:8},{default:a(()=>[d("div",Rt,[n(ke,{modelValue:U.value,"onUpdate:modelValue":e[8]||(e[8]=t=>U.value=t),label:o(i)("selectAll"),size:"large"},null,8,["modelValue","label"]),n(I,{class:"ml-[15px]",disabled:K.value,onClick:e[9]||(e[9]=t=>W())},{default:a(()=>[k(r(o(i)("delete")),1)]),_:1},8,["disabled"]),n(I,{disabled:K.value,onClick:e[10]||(e[10]=t=>X())},{default:a(()=>[k(r(o(i)("upload.move")),1)]),_:1},8,["disabled"])])]),_:1})):g("",!0),n(D,{span:u.scene=="attachment"?16:24},{default:a(()=>[d("div",Mt,[n(we,{"current-page":c.page,"onUpdate:current-page":e[11]||(e[11]=t=>c.page=t),small:!0,"page-size":c.limit,"onUpdate:page-size":e[12]||(e[12]=t=>c.limit=t),"page-sizes":[10,20,30,40,60],layout:"total, sizes, prev, pager, next, jumper",total:c.total,onSizeChange:e[13]||(e[13]=t=>o($)()),onCurrentChange:o($)},null,8,["current-page","page-size","total","onCurrentChange"])])]),_:1},8,["span"])]),_:1})]),u.scene=="attachment"?(s(),p(P,{key:0},[n(ae,{modelValue:v.visible,"onUpdate:modelValue":e[17]||(e[17]=t=>v.visible=t),title:o(i)("upload.moveCategory"),width:"350px"},{footer:a(()=>[d("span",Jt,[n(I,{onClick:e[15]||(e[15]=t=>v.visible=!1)},{default:a(()=>[k(r(o(i)("cancel")),1)]),_:1}),n(I,{type:"primary",loading:v.loading,onClick:e[16]||(e[16]=t=>v.confirm())},{default:a(()=>[k(r(o(i)("confirm")),1)]),_:1},8,["loading"])])]),default:a(()=>[n(Ee,{"label-width":"60px"},{default:a(()=>[n(Ve,{label:o(i)("upload.moveTo"),style:{"margin-bottom":"0"}},{default:a(()=>[n(Ce,{modelValue:v.cateId,"onUpdate:modelValue":e[14]||(e[14]=t=>v.cateId=t),class:"input-width"},{default:a(()=>[(s(!0),p(P,null,N(E.data,(t,y)=>(s(),_(be,{label:t.name,value:t.id,key:y},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"]),F.show?(s(),_($e,{key:0,"url-list":o(ge),onClose:e[18]||(e[18]=t=>F.show=!1),"initial-index":F.index,"zoom-rate":1},null,8,["url-list","initial-index"])):g("",!0),n(ae,{modelValue:j.visible,"onUpdate:modelValue":e[19]||(e[19]=t=>j.visible=t),width:"50%","align-center":"","destroy-on-close":!0,"custom-class":"video-preview"},{default:a(()=>[n(Ie,{src:j.src,width:"100%"},null,8,["src"])]),_:1},8,["modelValue"])],64)):g("",!0)],2)}}});const xl=ft(Kt,[["__scopeId","data-v-418ecbbf"]]);export{xl as default};
